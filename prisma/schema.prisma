generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Disease {
  Flu
  Tetanus
}

enum JobType {
  Cop
  Vet
  Doctor
}

enum ItemType {
  Greenhouse
  Weapon
  Armor
  Food
  Farm
  Tool
  Ore
}

model Guild {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  discordId String @unique

  users    User[]   @relation(references: [id], fields: [usersIds], name: "GuildsUsers")
  usersIds String[] @db.ObjectId

  editors    User[]   @relation(references: [id], fields: [editorsIds], name: "GuildsEditors")
  editorsIds String[] @db.ObjectId

  imprisonedUsers   UserPrison[]
  userGuildBalances UserGuildData[]

  blacklistedCommands String[]
}

model User {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  discordId String @unique

  guilds    Guild[]  @relation(references: [id], fields: [guildsIds], name: "GuildsUsers")
  guildsIds String[] @db.ObjectId

  guildsEditors   Guild[]  @relation(fields: [guildsEditorsId], references: [id], name: "GuildsEditors")
  guildsEditorsId String[] @db.ObjectId

  guildPrisoners UserPrison[]
  userGuildDatas UserGuildData[]

  diamonds Int @default(0)
}

model UserPrison {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  guild   Guild  @relation(fields: [guildId], references: [id])
  guildId String @db.ObjectId

  releasedAt DateTime?
}

model Job {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users UserGuildData[]
  type  JobType         @unique

  cooldown DateTime?
  salary   Float
}

model Item {
  id   String @id @default(auto()) @map("_id") @db.ObjectId
  slug String @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  inventories InventoryItem[]

  name        String
  description String

  type  ItemType
  emoji String

  price           Float
  priceInDiamonds Boolean @default(false)

  data Json?
}

model Inventory {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   UserGuildData @relation(fields: [userId], references: [id])
  userId String        @unique @db.ObjectId

  items InventoryItem[]
}

model InventoryItem {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  item   Item   @relation(fields: [itemId], references: [id])
  itemId String @db.ObjectId

  inventory   Inventory @relation(fields: [inventoryId], references: [id])
  inventoryId String    @db.ObjectId

  amount Int   @default(1)
  data   Json?

  @@unique([itemId, inventoryId])
}

model UserGuildData {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  guild   Guild  @relation(fields: [guildId], references: [id])
  guildId String @db.ObjectId

  job   Job?    @relation(fields: [jobId], references: [id])
  jobId String? @db.ObjectId

  disease   Disease?
  inventory Inventory?

  farm       Farm?
  greenhouse Greenhouse?

  lastDaily DateTime?

  energy          Int       @default(1000)
  energyUpdatedAt DateTime?

  balance      Float @default(0)
  bankBalance  Float @default(0)
  dirtyBalance Float @default(0)

  @@unique([userId, guildId])
}

model Farm {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userGuildData   UserGuildData @relation(fields: [userGuildDataId], references: [id])
  userGuildDataId String        @unique @db.ObjectId

  // number[][]
  purchasedArea Json
  plantData     Json
}

model Greenhouse {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userGuildData   UserGuildData @relation(fields: [userGuildDataId], references: [id])
  userGuildDataId String        @unique @db.ObjectId

  // number[][]
  purchasedArea Json
  plantData     Json
}
