generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Guild {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  discordId String @unique

  users    User[]   @relation(references: [id], fields: [usersIds], name: "GuildsUsers")
  usersIds String[] @db.ObjectId

  editors    User[]   @relation(references: [id], fields: [editorsIds], name: "GuildsEditors")
  editorsIds String[] @db.ObjectId

  // transactions Transaction[]

  imprisonedUsers   UserPrison[]
  userGuildBalances UserGuildData[]

  blacklistedCommands String[]
}

model User {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  discordId String @unique

  guilds    Guild[]  @relation(references: [id], fields: [guildsIds], name: "GuildsUsers")
  guildsIds String[] @db.ObjectId

  guildsEditors   Guild[]  @relation(fields: [guildsEditorsId], references: [id], name: "GuildsEditors")
  guildsEditorsId String[] @db.ObjectId

  guildPrisoners UserPrison[]
  userGuildDatas UserGuildData[]

  diamonds Int @default(0)
}

enum Disease {
  Flu
  Tetanus
}

model UserGuildData {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  guild   Guild  @relation(fields: [guildId], references: [id])
  guildId String @db.ObjectId

  job   Job?    @relation(fields: [jobId], references: [id])
  jobId String? @db.ObjectId

  // transactions          Transaction[] @relation("UserGuildBalanceTransactions")
  // senderTransactions    Transaction[] @relation("SenderGuildBalanceTransactions")
  // recipientTransactions Transaction[] @relation("RecipientGuildBalanceTransactions")

  lastDaily DateTime?

  energy          Int       @default(1000)
  energyUpdatedAt DateTime?

  balance      Float @default(0)
  bankBalance  Float @default(0)
  dirtyBalance Float @default(0)

  disease   Disease?
  inventory Inventory?
}

model UserPrison {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  guild   Guild  @relation(fields: [guildId], references: [id])
  guildId String @db.ObjectId

  releasedAt DateTime?
}

// enum TransactionType {
//   Crime
//   Deposit
//   Withdraw
//   TransferIn
//   TransferOut
// }

// enum TransactionStatus {
//   Success
//   Pending
//   Failed
// }

// model Transaction {
//   id String @id @default(auto()) @map("_id") @db.ObjectId

//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   type   TransactionType
//   status TransactionStatus @default(Pending)

//   amount      Float
//   description String?

//   userGuildBalance   UserGuildData? @relation("UserGuildBalanceTransactions", fields: [userGuildBalanceId], references: [id])
//   userGuildBalanceId String?        @db.ObjectId

//   senderGuildBalance   UserGuildData? @relation("SenderGuildBalanceTransactions", fields: [senderGuildBalanceId], references: [id])
//   senderGuildBalanceId String?        @db.ObjectId

//   recipientGuildBalance   UserGuildData? @relation("RecipientGuildBalanceTransactions", fields: [recipientGuildBalanceId], references: [id])
//   recipientGuildBalanceId String?        @db.ObjectId

//   guild   Guild  @relation(fields: [guildId], references: [id])
//   guildId String @db.ObjectId
// }

enum JobType {
  Cop
  Vet
  Doctor
}

model Job {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users UserGuildData[]
  type  JobType

  cooldown DateTime?
  salary   Float
}

enum ItemType {
  Weapon
  Armor
  Food
  Farm
  Tool
  Ore
}

model Item {
  id   String @id @default(auto()) @map("_id") @db.ObjectId
  slug String @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  inventories InventoryItem[]

  name        String
  description String

  type  ItemType
  emoji String

  price           Float
  priceInDiamonds Boolean @default(false)

  // This allows to have a custom data for each item.
  // For example, a weapon can have a damage property and a armor can have a defense property.
  data Json?
}

model InventoryItem {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  item   Item   @relation(fields: [itemId], references: [id])
  itemId String @db.ObjectId

  inventory   Inventory @relation(fields: [inventoryId], references: [id])
  inventoryId String    @db.ObjectId

  amount Int   @default(1)
  data   Json?
}

model Inventory {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   UserGuildData @relation(fields: [userId], references: [id])
  userId String        @unique @db.ObjectId

  items InventoryItem[]
}
